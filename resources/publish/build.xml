<project name="jminor-publish" xmlns:ivy="antlib:org.apache.ivy.ant">

  <property file="../../../build.properties"/>
  <property file="../../../user.properties"/>
  <property name="dist.dir" value="../../../dist"/>

  <property name="ivy.pom.version" value="${version}"/>

  <taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpath="${ivy.jar}"/>

  <target name="create-pom">
    <ivy:resolve/>
    <ivy:deliver deliverpattern="ivy.xml" pubrevision="${version}"/>
    <ivy:makepom ivyfile="ivy.xml" pomfile="${ant.project.name}.pom">
      <mapping conf="default" scope="compile" />
      <mapping conf="sources" scope="sources" />
      <mapping conf="javadoc" scope="javadoc" />
    </ivy:makepom>
  </target>

  <target name="copy-artifacts">
    <copy todir=".">
      <fileset dir="${dist.dir}/${ant.project.name}"/>
    </copy>
  </target>

  <target name="publish" depends="copy-artifacts, create-pom">
    <fail unless="version">Version information not set</fail>
    <ivy:publish pubrevision="${version}" status="release" resolver="publish" overwrite="true" forcedeliver="true">
      <artifacts pattern="[artifact].[ext]"/>
    </ivy:publish>
  </target>
</project>