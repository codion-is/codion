<project name="jminor-framework">

  <property name="project.root" value="../"/>
  <import file="../build-common.xml"/>

  <target name="dist" depends="common.dist"
          description="Builds all distribution jar files in the dist directory">
    <dist_module module-name="jminor-framework-db-core"
                 includes="org/jminor/framework/Configuration.class,
                 org/jminor/framework/db/*,
                 org/jminor/framework/db/criteria/*,
                 org/jminor/framework/domain/*,
                 org/jminor/framework/i18n/**"
                 excludes="org/jminor/framework/db/remote*,
                 org/jminor/framework/db/local*,"/>
    <dist_module module-name="jminor-framework-db-local"
                 includes="org/jminor/framework/db/local/*"/>
    <dist_module module-name="jminor-framework-db-remote"
                 includes="org/jminor/framework/db/remote/*"/>
    <dist_module module-name="jminor-framework-db-test"
                 includes="org/jminor/framework/testing/EntityTestUnit*"/>
    <dist_module module-name="jminor-framework-model"
                 includes="org/jminor/framework/model/*"/>
    <dist_module module-name="jminor-framework-model-unittests"
                 includes="org/jminor/common/model/tools/LoadTestModelTest*,
                 org/jminor/framework/domain/TestDomain*,
                 org/jminor/framework/model/Abstract*,
                 org/jminor/framework/db/EntityConnectionProvidersTest*,
                 org/jminor/framework/server/EntityConnectionServerTest*,
                 org/jminor/framework/server/TestConnectionValidator*
                 org/jminor/framework/server/TestLoginProxy*"
                 build.basedir="${build.test}"
                 src.basedir="${src.test}"/>
    <dist_module module-name="jminor-framework-server"
                 includes="org/jminor/framework/Configuration.class,
                 org/jminor/framework/server/*"/>

    <copy file="${basedir}/../changelog.txt" todir="${dist}"/>
  </target>

  <target name="deploy" depends="dist"
          description="deploy all module artifacts">
    <fail unless="version">Version information not set</fail>
    <subant target="deploy" buildpath="${basedir}/modules/framework-db-core"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-db-local"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-db-remote"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-db-test"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-model"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-model-unittests"/>
    <subant target="deploy" buildpath="${basedir}/modules/framework-server"/>
  </target>

  <target name="install" depends="dist"
          description="install all module artifacts">
    <fail unless="version">Version information not set</fail>
    <subant target="install" buildpath="${basedir}/modules/framework-db-core"/>
    <subant target="install" buildpath="${basedir}/modules/framework-db-local"/>
    <subant target="install" buildpath="${basedir}/modules/framework-db-remote"/>
    <subant target="install" buildpath="${basedir}/modules/framework-db-test"/>
    <subant target="install" buildpath="${basedir}/modules/framework-model"/>
    <subant target="install" buildpath="${basedir}/modules/framework-model-unittests"/>
    <subant target="install" buildpath="${basedir}/modules/framework-server"/>
  </target>

  <target name="javadoc" depends="build" unless="skip.javadoc"
          description="Generates framework javadocs">
    <delete dir="${javadoc}" includeEmptyDirs="true"/>
    <mkdir dir="${javadoc}"/>
    <javadoc destdir="${javadoc}" sourcepath="${src.main}" packagenames="org.jminor.*" Encoding="UTF-8"
             docencoding="UTF-8" author="true" version="true" use="true"
             windowtitle="JMinor v${version} API" doctitle="JMinor v${version} API"
             group="Db org.jminor.framework.db*,
                    Domain org.jminor.framework.domain*,
                    Client model org.jminor.framework.model*,
                    Swing client org.jminor.swing*,
                    Server org.jminor.framework.server*">
      <classpath refid="lib.compile"/>
      <link href="http://download.oracle.com/javase/8/docs/api/"/>
    </javadoc>
  </target>

</project>