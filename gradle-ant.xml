<project name="org.jminor">

  <property name="demo.server.keystorePassword" value="crappypass"/>

  <condition property="keystore.available">
    <available file="resources/security/JMinorServerKeystore"/>
  </condition>

  <target name="createKeystore" unless="keystore.available"
          description="Creates a client/server keystore for running the demos">
    <mkdir dir="resources/security"/>
    <genkey alias="JMinorServer" keyalg="RSA" storepass="${demo.server.keystorePassword}" validity="365"
            keystore="resources/security/JMinorServerKeystore">
      <dname>
        <param name="CN" value="Dummy"/>
        <param name="OU" value="dummy"/>
        <param name="O" value="dummy.org"/>
        <param name="C" value="DU"/>
      </dname>
    </genkey>
    <exec executable="${java.home}/bin/keytool" failonerror="true">
      <arg value="-exportcert"/>
      <arg line="-keystore resources/security/JMinorServerKeystore"/>
      <arg line="-alias JMinorServer"/>
      <arg line="-storepass ${demo.server.keystorePassword}"/>
      <arg line="-rfc"/>
      <arg line="-file resources/security/JMinorServer.cer"/>
    </exec>
    <exec executable="${java.home}/bin/keytool" failonerror="true">
      <arg value="-import"/>
      <arg line="-alias JMinorServer"/>
      <arg line="-storepass ${demo.server.keystorePassword}"/>
      <arg line="-file resources/security/JMinorServer.cer"/>
      <arg line="-keystore resources/security/JMinorClientTruststore"/>
      <arg line="-noprompt"/>
    </exec>
    <copy file="resources/security/JMinorClientTruststore"
          tofile="resources/security/JMinorServerMonitorTruststore"/>
    <delete file="resources/security/JMinorServer.cer"/>
  </target>
</project>