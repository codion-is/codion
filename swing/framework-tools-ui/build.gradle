import org.javamodularity.moduleplugin.tasks.ModularJavaExec

apply plugin: 'application'

dependencies {
    implementation project(':codion-common-core')
    implementation project(':codion-common-db')
    implementation project(':codion-common-model')

    implementation project(':codion-swing-common-tools')
    implementation project(':codion-swing-common-model')
    implementation project(':codion-swing-common-ui')
    api project(':codion-swing-framework-tools')

    runtimeOnly project(':codion-dbms-h2database')
    runtimeOnly (libs.h2)

//    runtimeOnly project(':codion-dbms-postgresql')
//    runtimeOnly 'org.postgresql:postgresql:42.5.4'

//    runtimeOnly project(':codion-dbms-oracle')
//    runtimeOnly ('com.oracle.database.jdbc:ojdbc8:21.7.0.0') { transitive false }

//    runtimeOnly project(':codion-dbms-mariadb')
//    runtimeOnly 'org.mariadb.jdbc:mariadb-java-client:3.0.6'

//    runtimeOnly project(':codion-dbms-db2database')
//    runtimeOnly 'com.ibm.db2:jcc:11.5.8.0'

    testRuntimeOnly project(':codion-framework-db-local')
    testRuntimeOnly project(':codion-framework-db-rmi')
    testRuntimeOnly project(':codion-framework-server')
}

ext {
    testAddModules = ['is.codion.common.db,is.codion.common.model,is.codion.swing.common.model']
    testAddReads = ['is.codion.swing.framework.tools.ui': 'is.codion.common.db,is.codion.common.model,is.codion.swing.common.model']
}

compileTestJava {
    moduleOptions {
        addModules = testAddModules
        addReads = testAddReads
    }
}

test {
    moduleOptions {
        addModules = testAddModules
        addReads = testAddReads
    }
}

distributions {
    main {
        distributionBaseName = "codion.database.explorer"
    }
}

applicationName = 'database_explorer'

mainClassName = 'is.codion.swing.framework.tools.ui.explorer.DatabaseExplorerPanel'

applicationDefaultJvmArgs = [
        '-Dcodion.configurationFile=../config/database_explorer.config',
        '-Dlogback.configurationFile=../config/logback.xml'
]

applicationDistribution.into('config') {
    from(files('src/main/config/database_explorer.config'))
    from(files('src/main/config/create_schema.sql'))
    from(files('src/main/config/logback.xml'))
}

tasks.register('runDatabaseExplorerH2', ModularJavaExec) {
    group 'application'
    mainClass.set('is.codion.swing.framework.tools.ui.explorer.DatabaseExplorerPanel')
    mainModule.set(moduleName)
    classpath = sourceSets.main.runtimeClasspath
    systemProperties = [
            'codion.db.url'        : 'jdbc:h2:mem:h2db',
            'codion.db.initScripts':
                    '../../demos/chinook/src/main/sql/create_schema.sql,' +
                    '../../demos/empdept/src/main/sql/create_schema.sql,' +
                    '../../demos/petclinic/src/main/sql/create_schema.sql,' +
                    '../../demos/petstore/src/main/sql/create_schema.sql,' +
                    '../../demos/world/src/main/sql/create_schema.sql'
    ]
}

//tasks.register('runDatabaseExplorerOracle', ModularJavaExec) {
//    group 'application'
//    mainClass.set('is.codion.swing.framework.tools.ui.explorer.DatabaseExplorerPanel')
//    mainModule.set(moduleName)
//    classpath = sourceSets.main.runtimeClasspath
//    systemProperties = [
//            'codion.db.url': 'jdbc:oracle:thin:@localhost:1521:sid'
//    ]
//}

//tasks.register('runDatabaseExplorerPostgres', ModularJavaExec) {
//    group 'application'
//    mainClass.set('is.codion.swing.framework.tools.ui.explorer.DatabaseExplorerPanel')
//    mainModule.set(moduleName)
//    classpath = sourceSets.main.runtimeClasspath
//    systemProperties = [
//            'codion.db.url': 'jdbc:postgresql://localhost:5432/postgres'
//    ]
//}

//tasks.register('runDatabaseExplorerMariaDB', ModularJavaExec) {
//    group 'application'
//    mainClass.set('is.codion.swing.framework.tools.ui.explorer.DatabaseExplorerPanel')
//    mainModule.set(moduleName)
//    classpath = sourceSets.main.runtimeClasspath
//    systemProperties = [
//            'codion.db.url': 'jdbc:mariadb://localhost:3306/mariadb'
//    ]
//}