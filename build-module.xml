<project name="jminor-module" xmlns:ivy="antlib:org.apache.ivy.ant">

  <property name="project.root" value="../../.."/>
  <property file="${project.root}/build.properties"/>
  <property file="${project.root}/user.properties"/>
  <property name="base.dir" value="../../dist/${ant.project.name}"/>

  <property name="ivy.pom.version" value="${version}"/>
  <property name="ivy.pom.url" value="http://jminor.org"/>

  <path id="lib.ant.util">
    <fileset dir="${project.root}/${lib}/ant"/>
  </path>

  <taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpathref="lib.ant.util"/>

  <target name="publish">
    <fail unless="version">Version information not set</fail>
    <copy file="ivy.xml" tofile="ivy.xml.bak" overwrite="true"/>
    <ivy:settings file="${project.root}/ivysettings.xml"/>
    <ivy:resolve/>
    <ivy:deliver deliverpattern="ivy.xml" pubrevision="${version}"/>
    <ivy:makepom ivyfile="ivy.xml" pomfile="${base.dir}/${ant.project.name}.pom">
      <mapping conf="compile" scope="compile" />
      <mapping conf="runtime" scope="runtime" />
      <mapping conf="test" scope="test" />
      <mapping conf="sources" scope="sources" />
      <mapping conf="javadoc" scope="javadoc" />
    </ivy:makepom>
    <ivy:publish pubrevision="${version}" status="${release.status}" resolver="publish.${release.status}" overwrite="true" forcedeliver="true">
      <artifacts pattern="${base.dir}/[artifact].[ext]"/>
    </ivy:publish>
    <move file="ivy.xml.bak" tofile="ivy.xml"/>
  </target>

  <target name="report">
    <ivy:resolve/>
    <ivy:report conf="runtime" graph="false" todir="../../ivy_reports/${ant.project.name}"/>
  </target>
</project>