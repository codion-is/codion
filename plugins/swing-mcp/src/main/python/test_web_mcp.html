<!DOCTYPE html>
<html>
<head>
    <title>Codion MCP Test Interface</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; }
        .tool-button { margin: 5px; padding: 10px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .tool-button:hover { background: #005a87; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; }
        .input-group { margin: 10px 0; }
        label { display: inline-block; width: 120px; }
        input { padding: 5px; width: 200px; }
        #screenshot { max-width: 100%; border: 1px solid #ccc; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Codion MCP Test Interface</h1>
        <p>Test the MCP integration with your Codion application</p>
        
        <h3>Quick Actions</h3>
        <button class="tool-button" onclick="callTool('app_screenshot')">Take Screenshot</button>
        <button class="tool-button" onclick="callTool('app_window_bounds')">Get Window Bounds</button>
        <button class="tool-button" onclick="callTool('focus_window')">Focus Window</button>
        <button class="tool-button" onclick="callTool('enter')">Press Enter</button>
        <button class="tool-button" onclick="callTool('tab')">Press Tab</button>
        
        <h3>Type Text</h3>
        <div class="input-group">
            <label>Text:</label>
            <input type="text" id="textInput" placeholder="Hello World">
            <button class="tool-button" onclick="typeText()">Type</button>
        </div>
        
        <h3>Key Combinations</h3>
        <div class="input-group">
            <label>Key Combo:</label>
            <input type="text" id="keyCombo" placeholder="ctrl a">
            <button class="tool-button" onclick="pressKeyCombo()">Press</button>
        </div>
        
        <h3>Arrow Keys</h3>
        <button class="tool-button" onclick="arrow('up')">↑ Up</button>
        <button class="tool-button" onclick="arrow('down')">↓ Down</button>
        <button class="tool-button" onclick="arrow('left')">← Left</button>
        <button class="tool-button" onclick="arrow('right')">→ Right</button>
        
        <h3>Result</h3>
        <div id="result" class="result">Ready to test...</div>
        
        <img id="screenshot" style="display: none;">
    </div>

    <script>
        const baseUrl = 'http://localhost:8080/mcp';
        
        async function callTool(toolName, args = {}) {
            try {
                const response = await fetch(`${baseUrl}/tools/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: toolName, arguments: args })
                });
                
                const result = await response.json();
                displayResult(toolName, result);
                
                // Handle screenshot display
                if (toolName.includes('screenshot') && result.content) {
                    let content = result.content;
                    if (typeof content === 'string') {
                        content = JSON.parse(content);
                    }
                    if (content.image) {
                        const img = document.getElementById('screenshot');
                        img.src = `data:image/${content.format || 'png'};base64,${content.image}`;
                        img.style.display = 'block';
                    }
                }
            } catch (error) {
                displayResult(toolName, { error: error.message });
            }
        }
        
        function displayResult(toolName, result) {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.textContent = `[${timestamp}] ${toolName}: ${JSON.stringify(result, null, 2)}`;
        }
        
        function typeText() {
            const text = document.getElementById('textInput').value;
            callTool('type_text', { text });
        }
        
        function pressKeyCombo() {
            const combo = document.getElementById('keyCombo').value;
            callTool('key_combo', { combo });
        }
        
        function arrow(direction) {
            callTool('arrow', { direction, count: 1 });
        }
        
        // Test server connection on load
        window.onload = async () => {
            try {
                const response = await fetch(`${baseUrl}/status`);
                const status = await response.json();
                displayResult('server_status', status);
            } catch (error) {
                displayResult('server_status', { error: 'Server not running' });
            }
        };
    </script>
</body>
</html>