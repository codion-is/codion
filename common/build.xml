<?xml version="1.0" encoding="UTF-8"?>
<project name="jminor-common" default="build" basedir=".">

  <property name="project.root" value="../"/>
  <import file="../build-common.xml"/>

  <tstamp>
    <format property="build.date" pattern="yyyy.MM.dd HH:mm"/>
  </tstamp>

  <target name="build" depends="common.build" description="Creates a version file before building">
    <concat destfile="${build.main}/org/jminor/common/version.txt">${version}-build ${build.date}</concat>
  </target>

  <target name="dist" depends="build, javadoc"
          description="Builds all distribution jar files in the dist directory">
    <dist_module module-name="jminor-common-core"
                 includes="org/jminor/common/*.*,
                 org/jminor/common/i18n/**,
                 org/jminor/common/model/Conjunction*,
                 org/jminor/common/model/User*,
                 org/jminor/common/model/Version*"/>
    <dist_module module-name="jminor-common-model"
                 includes="org/jminor/common/model/**"
                 excludes="org/jminor/common/model/Conjunction*,
                 org/jminor/common/model/User*,
                 org/jminor/common/model/Version*"/>
    <dist_module module-name="jminor-common-db"
                 includes="org/jminor/common/db/**"/>
    <dist_module module-name="jminor-common-server"
                 includes="org/jminor/common/server/**"/>
  </target>

  <target name="deploy" depends="dist" description="Publish all project artifacts">
    <fail unless="version">Version information not set</fail>
    <subant target="deploy" buildpath="${basedir}/modules/common-core"/>
    <subant target="deploy" buildpath="${basedir}/modules/common-model"/>
    <subant target="deploy" buildpath="${basedir}/modules/common-db"/>
    <subant target="deploy" buildpath="${basedir}/modules/common-server"/>
  </target>

  <target name="install" depends="dist" description="Publish all project artifacts">
    <fail unless="version">Version information not set</fail>
    <subant target="install" buildpath="${basedir}/modules/common-core"/>
    <subant target="install" buildpath="${basedir}/modules/common-model"/>
    <subant target="install" buildpath="${basedir}/modules/common-db"/>
    <subant target="install" buildpath="${basedir}/modules/common-server"/>
  </target>
</project>